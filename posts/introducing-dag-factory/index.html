<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Adam Boscarino"><meta name=description content="Personal site for Adam Boscarino"><meta name=keywords content="blog,developer,personal,data,engineer"><meta name=twitter:card content="summary"><meta name=twitter:title content="Introducing dag-factory"><meta name=twitter:description content="generate Airflow DAGs from YAML configs"><meta property="og:title" content="Introducing dag-factory"><meta property="og:description" content="generate Airflow DAGs from YAML configs"><meta property="og:type" content="article"><meta property="og:url" content="https://adam.boscarino.me/posts/introducing-dag-factory/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-11-21T00:00:00+00:00"><meta property="article:modified_time" content="2018-11-21T00:00:00+00:00"><base href=https://adam.boscarino.me/posts/introducing-dag-factory/><title>Introducing dag-factory · Adam Boscarino</title><link rel=canonical href=https://adam.boscarino.me/posts/introducing-dag-factory/><link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel=stylesheet><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.11.2/css/all.css integrity=sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><link rel=stylesheet href=https://adam.boscarino.me/css/coder.min.a4f332213a21ce8eb521670c614470c58923aaaf385e2a73982c31dd7642decb.css integrity="sha256-pPMyITohzo61IWcMYURwxYkjqq84XipzmCwx3XZC3ss=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://adam.boscarino.me/css/coder-dark.min.5efe5f122c926bde3c37546cb3804770b7cd5c2837919f0bbf752e632c0dd20f.css integrity="sha256-Xv5fEiySa948N1Rss4BHcLfNXCg3kZ8Lv3UuYywN0g8=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=https://adam.boscarino.me/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://adam.boscarino.me/images/favicon-16x16.png sizes=16x16><meta name=generator content="Hugo 0.82.0"></head><body class=colorscheme-dark><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://adam.boscarino.me/>HOME</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fas fa-bars"></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://adam.boscarino.me/about/>ABOUT</a></li><li class=navigation-item><a class=navigation-link href=https://adam.boscarino.me/work/>WORK</a></li><li class=navigation-item><a class=navigation-link href=https://adam.boscarino.me/projects/>PROJECTS</a></li><li class=navigation-item><a class=navigation-link href=https://adam.boscarino.me/talks/>TALKS</a></li><li class=navigation-item><a class=navigation-link href=https://adam.boscarino.me/posts/>BLOG</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title>Introducing dag-factory</h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fas fa-calendar"></i>
<time datetime=2018-11-21T00:00:00Z>November 21, 2018</time></span>
<span class=reading-time><i class="fas fa-clock"></i>
3-minute read</span></div></div></header><div><p><a href=https://github.com/apache/incubator-airflow>Apache Airflow</a> is &ldquo;a platform to programmatically author, schedule, and monitor workflows.&rdquo; And it is currently having its <em>moment</em>. At <a href=https://www.dataengconf.com/speakers-nyc18>DataEngConf NYC 2018</a>, it seemed like every other talk was either about or mentioned Airflow. There have also been <a href=https://medium.com/making-meetup/data-pipeline-infrastructure-at-meetup-with-fewer-nightmares-running-apache-airflow-on-kubernetes-54cb8cdc69c3>countless</a> <a href=https://medium.com/bluecore-engineering/were-all-using-airflow-wrong-and-how-to-fix-it-a56f14cb0753>blog</a> <a href=https://bostata.com/post/built-to-scale-running-highly-concurrent-etl-with-apache-airflow/>posts</a> about how different companies are using the tool and it even has a <a href=https://soundcloud.com/the-airflow-podcast>podcast</a>!</p><p>A major use case for Airflow seems to be ETL or ELT or ETTL or whatever acronym we are using today for moving data in batches from production systems to data warehouses. This is a pattern that will typically be repeated in multiple pipelines. I recently gave a <a href=https://github.com/ajbosco/talks/blob/master/nyc-data-eng-meetup/airflow-at-do.pdf>talk</a> on how we are using Airflow at my day job and use YAML configs to make these repeated pipelines easy to write, update, and extend. This approach is inspired by Chris Riccomini&rsquo;s seminal post on <a href=https://wecode.wepay.com/posts/airflow-wepay>Airflow at WePay</a>. Someone in the audience then asked &ldquo;how are you going from YAML to Airflow DAGs?&rdquo; My response was that we had a Python file that parsed the configs and generated the DAGs. This answer didn&rsquo;t seem to satisfy the audience member or myself. This pattern is very common in talks or posts about Airflow, but it seems like we are all writing the same logic independently. Thus the idea for <a href=https://github.com/ajbosco/dag-factory>dag-factory</a> was born.</p><p>The <a href=https://github.com/ajbosco/dag-factory>dag-factory</a> library makes it easy to create DAGs from YAML configuration by following a few steps. First, install dag-factory into your Airflow environment:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>pip install dag-factory
</code></pre></div><p>Next create a YAML config in a place accessible to Airflow like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>example_dag1</span>:
  <span style=color:#ff79c6>default_args</span>:
    <span style=color:#ff79c6>owner</span>: <span style=color:#f1fa8c>&#39;example_owner&#39;</span>
    <span style=color:#ff79c6>start_date</span>: 2018-01-01
  <span style=color:#ff79c6>schedule_interval</span>: <span style=color:#f1fa8c>&#39;0 3 * * *&#39;</span>
  <span style=color:#ff79c6>description</span>: <span style=color:#f1fa8c>&#39;this is an example dag!&#39;</span>
  <span style=color:#ff79c6>tasks</span>:
    <span style=color:#ff79c6>task_1</span>:
      <span style=color:#ff79c6>operator</span>: airflow.operators.bash_operator.BashOperator
      <span style=color:#ff79c6>bash_command</span>: <span style=color:#f1fa8c>&#39;echo 1&#39;</span>
    <span style=color:#ff79c6>task_2</span>:
      <span style=color:#ff79c6>operator</span>: airflow.operators.bash_operator.BashOperator
      <span style=color:#ff79c6>bash_command</span>: <span style=color:#f1fa8c>&#39;echo 2&#39;</span>
      <span style=color:#ff79c6>dependencies</span>: [task_1]
    <span style=color:#ff79c6>task_3</span>:
      <span style=color:#ff79c6>operator</span>: airflow.operators.bash_operator.BashOperator
      <span style=color:#ff79c6>bash_command</span>: <span style=color:#f1fa8c>&#39;echo 3&#39;</span>
      <span style=color:#ff79c6>dependencies</span>: [task_1]
</code></pre></div><p>Then create a <code>.py</code> file in your Airflow DAGs folder like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#ff79c6>from</span> airflow <span style=color:#ff79c6>import</span> DAG
<span style=color:#ff79c6>import</span> dagfactory

dag_factory <span style=color:#ff79c6>=</span> dagfactory<span style=color:#ff79c6>.</span>DagFactory(<span style=color:#f1fa8c>&#34;/path/to/dags/config_file.yml&#34;</span>)

dag_factory<span style=color:#ff79c6>.</span>generate_dags(<span style=color:#8be9fd;font-style:italic>globals</span>())
</code></pre></div><p>And :bam: you&rsquo;ll have a DAG running in Airflow that looks like this:</p><p><img src=https://adam.boscarino.me/images/example_dag.png alt="example dag"></p><p>This approach offers a number of benefits including that Airflow DAGs can be created with no Python knowledge. This opens the platform to non-engineers on your team, which can be a productivity boost to both your organization and data platform.</p><p><a href=https://github.com/ajbosco/dag-factory>dag-factory</a> also allows engineers who do not regularly work with Airflow to create DAGs. These people frequently want to use the great features of Airflow (monitoring, retries, alerting, etc.), but learning about Hooks and Operators are outside the scope of their day-to-day jobs. Instead of having to read the docs (ewwww) to learn these primitives, they can create YAML configs just as easily as the cron job (ewwwwwwww) they were going to use. This will reduce the time spent onboarding new teams to Airflow dramatically.</p><p><a href=https://github.com/ajbosco/dag-factory>dag-factory</a> is a brand new project, so if you try it and have any suggestions or issues <a href=https://github.com/ajbosco/dag-factory/issues/new>let me know</a>! Similar tools include <a href=https://github.com/etsy/boundary-layer>boundary-layer</a> from etsy and <a href=https://github.com/wooga/airconditioner>airconditioner</a> (great name!) from wooga, so check them out too!</p></div><footer></footer></article></section></div><footer class=footer><section class=container>© 2021
Adam Boscarino
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-112552117-1','auto'),ga('send','pageview'))</script></body></html>